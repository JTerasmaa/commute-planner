<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸš† Static Schedule NÃµmme â†” TLÃœ Transit</title>
  <style>
    /* (styles unchanged) */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸš† Static Schedule NÃµmme â†” TLÃœ Transit</h1>
      <div class="current-time" id="currentTime"></div>
    </div>
    <div class="direction-toggle">
      <button class="toggle-btn active" id="morningBtn" onclick="setDirection('morning')">
        ðŸŒ… Morning (NÃµmme â†’ TLÃœ)
      </button>
      <button class="toggle-btn" id="eveningBtn" onclick="setDirection('evening')">
        ðŸŒ† Evening (TLÃœ â†’ NÃµmme)
      </button>
    </div>
    <div id="routes">
      <!-- Morning -->
      <div id="morning" class="route-group">
        <!-- Train -->
        <div class="route-section">
          <div class="route-header">
            <div class="route-icon train-icon">ðŸš†</div>
            <div class="route-title"><h3>NÃµmme â†’ Tallinn</h3></div>
          </div>
          <div class="departures" id="train-morning-deps"></div>
        </div>
        <!-- Tram -->
        <div class="route-section">
          <div class="route-header">
            <div class="route-icon tram-icon">1</div>
            <div class="route-title"><h3>Balti Jaam â†’ Tallinna Ãœlikool</h3></div>
          </div>
          <div class="departures" id="tram-morning-deps"></div>
        </div>
      </div>
      <!-- Evening -->
      <div id="evening" class="route-group" style="display:none;">
        <!-- Tram -->
        <div class="route-section">
          <div class="route-header">
            <div class="route-icon tram-icon">1</div>
            <div class="route-title"><h3>Tallinna Ãœlikool â†’ Balti Jaam</h3></div>
          </div>
          <div class="departures" id="tram-evening-deps"></div>
        </div>
        <!-- Train -->
        <div class="route-section">
          <div class="route-header">
            <div class="route-icon train-icon">ðŸš†</div>
            <div class="route-title"><h3>Tallinn â†’ NÃµmme</h3></div>
          </div>
          <div class="departures" id="train-evening-deps"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    const SCHEDULE_DATA = {
      "tramSchedule": {
        "Balti Jaam â†’ Tallinna Ãœlikool": {
          "weekdays": {
            "5": ["24","42"],
            "6": ["00","15","30","43","53"],
            "7": ["03","13","23","33","43","53"],
            "8": ["02","11","20","29","38","47","56"],
            "9": ["05","15","24","34","44","54"],
            "10": ["04","14","24","34","44","54"],
            "11": ["04","14","24","34","44","53"],
            "12": ["02","11","20","29","38","47","56"],
            "13": ["05","14","23","32","41","50","59"],
            "14": ["08","17","26","35","44","53"],
            "15": ["05","17","29","41","53"],
            "16": ["05","17","29","41","53"],
            "17": ["05","17","32","48"],
            "18": ["04","22","39","57"],
            "19": ["15","34","54"],
            "20": ["08","18","29","41","53"],
            "21": ["05","17","29","41","53"],
            "22": ["08","17","26","35","44","53"],
            "23": ["15","34","54"]
          },
          "weekends": {
            "5": ["44"],
            "6": ["04","24","42"],
            "7": ["00","18","36","54"],
            "8": ["09","21","33","45","57"],
            "9": ["09","21","33","45","57"],
            "10": ["09","21","33","45","56"],
            "11": ["07","18","29","40","50"],
            "12": ["00","10","20","30","40","50"],
            "13": ["00","10","20","30","40","50"],
            "14": ["00","10","20","30","40","50"],
            "15": ["00","10","20","30","40","50"],
            "16": ["00","10","20","30","40","50"],
            "17": ["00","10","20","31","42","53"],
            "18": ["04","15","27","38","49"],
            "19": ["01","13","25","37","49"],
            "20": ["01","13","25","37","49"],
            "21": ["01","16","31","47"],
            "22": ["03","21","39","57"],
            "23": ["15","34","54"]
          }
        },
        "Tallinna Ãœlikool â†’ Balti Jaam": {
          "weekdays": {
            "5": ["23","42"],
            "6": ["00","18","33","48"],
            "7": ["01","14","24","34","44","54"],
            "8": ["04","14","23","32","41","50","59"],
            "9": ["08","17","26","35","45","55"],
            "10": ["05","15","25","35","45","55"],
            "11": ["06","16","26","36","46","55"],
            "12": ["05","14","23","32","41","50","59"],
            "13": ["08","17","26","35","44","53"],
            "14": ["02","11","20","29","38","47","56"],
            "15": ["05","14","23","32","41","50","59"],
            "16": ["08","17","26","35","44","53"],
            "17": ["02","11","20","29","39","49","58"],
            "18": ["08","18","29","39","51"],
            "19": ["02","14","26","38","50"],
            "20": ["02","14","26","38","51"],
            "21": ["03","14","26","38","52"],
            "22": ["08","25","42","59"],
            "23": ["17","35","53"],
            "0": ["13"]
          },
          "weekends": {
            "5": ["43"],
            "6": ["03","23","43"],
            "7": ["01","19","37","56"],
            "8": ["15","29","41","53"],
            "9": ["06","18","30","42","54"],
            "10": ["06","19","31","43","55"],
            "11": ["06","17","28","39","50"],
            "12": ["00","10","20","30","40","50"],
            "13": ["00","10","20","30","40","50"],
            "14": ["00","10","20","30","40","50"],
            "15": ["00","10","20","30","40","50"],
            "16": ["00","10","20","30","40","50"],
            "17": ["00","10","20","31","41","51"],
            "18": ["02","13","25","36","47","59"],
            "19": ["11","23","35","47","59"],
            "20": ["11","23","35","47","59"],
            "21": ["09","21","37","52"],
            "22": ["08","24","41","59"],
            "23": ["17","35","53"],
            "0": ["13"]
          }
        }
      },
      "trainSchedule": {
        "NÃµmme â†’ Tallinn": [
          "05:01","05:21","05:42","06:12","06:41","07:02","06:51","07:12","07:21","07:32","07:41","07:52",
          "08:01","08:12","08:21","08:32","08:31","08:41","09:02","09:21","09:41","10:02","10:21","10:41",
          "11:02","11:21","11:41","12:01","12:21","12:41","13:02","13:21","13:41","14:02","14:21","14:41",
          "15:01","15:11","15:21","15:41","15:51","16:02","16:21","16:31","16:41","17:01","17:21","17:32",
          "17:41","17:52","18:02","18:21","18:41","19:01","19:21","19:41","20:02","20:21","20:41","21:11",
          "21:41","22:11","22:41","23:12"
        ],
        "Tallinn â†’ NÃµmme": [
          "05:45","06:15","06:35","06:45","07:05","07:25","07:36","07:45","08:05","08:15","08:25","08:35",
          "08:45","08:55","09:05","09:25","09:45","10:05","10:25","10:45","11:05","11:25","11:45","12:05",
          "12:25","12:45","13:05","13:25","13:45","14:05","14:25","14:45","15:05","15:25","15:45","16:05",
          "16:16","16:25","16:36","16:45","16:56","17:05","17:16","17:25","17:45","18:05","18:15","18:25"
        ]
      }
    };

    let currentDirection = 'morning';

    function updateCurrentTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent =
        now.toLocaleDateString('et-EE', {weekday:'long', year:'numeric', month:'long', day:'numeric'}) +
        ' ' + now.toLocaleTimeString('et-EE', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }

    function setDirection(dir) {
      currentDirection = dir;
      document.getElementById('morningBtn').classList.toggle('active', dir==='morning');
      document.getElementById('eveningBtn').classList.toggle('active', dir==='evening');
      document.getElementById('morning').style.display = dir==='morning' ? 'block' : 'none';
      document.getElementById('evening').style.display = dir==='evening' ? 'block' : 'none';
      renderAll();
    }

    function isWeekend() {
      const d = new Date().getDay();
      return d === 0 || d === 6;
    }

    function pad(n){ return n.toString().padStart(2,'0'); }

    function getStaticTimes(routeId) {
      if (routeId.startsWith('tram')) {
        const key = routeId==='tram-morning'
          ? 'Balti Jaam â†’ Tallinna Ãœlikool'
          : 'Tallinna Ãœlikool â†’ Balti Jaam';
        const block = SCHEDULE_DATA.tramSchedule[key];
        const period = isWeekend() ? block.weekends : block.weekdays;
        const times = [];
        Object.entries(period).forEach(([hr, mins]) => {
          mins.forEach(m => times.push(`${pad(hr)}:${pad(m)}`));
        });
        return times.sort();
      } else {
        const key = routeId==='train-morning'
          ? 'NÃµmme â†’ Tallinn'
          : 'Tallinn â†’ NÃµmme';
        return SCHEDULE_DATA.trainSchedule[key];
      }
    }

    function generateUpcoming(routeId, count=6) {
      const times = getStaticTimes(routeId);
      const now = new Date();
      const nowMin = now.getHours()*60 + now.getMinutes();
      const upcoming = [];
      times.forEach(t => {
        const [h,m] = t.split(':').map(Number);
        const mins = h*60 + m;
        if (mins >= nowMin) upcoming.push({time: t, minutes: mins - nowMin});
      });
      if (upcoming.length < count) {
        times.slice(0, count - upcoming.length).forEach(t => {
          const [h,m] = t.split(':').map(Number);
          const mins = h*60 + m + 24*60;
          upcoming.push({time: t, minutes: mins - nowMin});
        });
      }
      return upcoming.slice(0, count);
    }

    function formatCard(dep, idx) {
      const cls = ['departure-card'];
      if (idx === 0) cls.push('next-departure');
      else if (dep.minutes <= 5) cls.push('soon');
      return `
        <div class="${cls.join(' ')}">
          <div class="departure-time">${dep.time}</div>
          <div class="countdown">${dep.minutes} min</div>
        </div>`;
    }

    function renderRoute(routeId, containerId) {
      const deps = generateUpcoming(routeId);
      const cont = document.getElementById(containerId);
      cont.innerHTML = deps.length
        ? deps.map((d,i)=>formatCard(d,i)).join('')
        : '<div class="no-data">No departures</div>';
    }

    function renderAll() {
      if (currentDirection === 'morning') {
        renderRoute('train-morning','train-morning-deps');
        renderRoute('tram-morning','tram-morning-deps');
      } else {
        renderRoute('tram-evening','tram-evening-deps');
        renderRoute('train-evening','train-evening-deps');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateCurrentTime(); setInterval(updateCurrentTime, 1000);
      renderAll();
    });
  </script>
</body>
</html>
